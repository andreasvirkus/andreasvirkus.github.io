{{> doc-head }}
<link rel="stylesheet" href="https://d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.1.3.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css" type="text/css">
</head>
<body class="wip-page" onload="settings()">
    {{> header }}

    {{> nav }}

    <main>
        {{{ contents }}}

        <div class="dashboard-container">
            <style>
            div[class^="col-"] {
                padding: 10px;
            }
            .keen-dataviz {
                background: #fff;
                border: 1px solid #e7e7e7;
                border-radius: 2px;
            }
            .keen-dataviz-title {
                border-bottom: 1px solid #e7e7e7;
                border-radius: 2px 2px 0 0;
                font-size: 13px;
                padding: 2px 10px 0;
                text-transform: uppercase;
            }
            .keen-dataviz-message {
                color: grey;
                display: block;
                font-size: 21px;
                font-weight: 200;
                line-height: 24px;
                text-align: center;
                box-sizing: border-box;
            }
            </style>
            <h3>General visitor data</h3>

            <div class="row">
                <div class="col-md-8 col-xs-12">
                  <div class="pageviews-interval"></div>
                </div>
                <div class="col-md-4 col-xs-12">
                  <div class="total-pageviews"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 col-xs-12">
                    <div class="pageviews-by-day"></div>
                </div>
                <div class="col-md-6 col-xs-12">
                    <div class="popular-pages-visited"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 col-xs-12">
                    <div class="pageviews-by-browser"></div>
                </div>
                <div class="col-md-6 col-xs-12">
                  <div class="pageviews-by-device"></div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 col-xs-12">
                    <div class="pageviews-by-country"></div>
                </div>
                <div class="col-md-6 col-xs-12">
                    <div class="pageviews-by-city"></div>
                </div>
            </div>
        </div>

        <script>
            window.renderCharts = function(client, timeframe) {
              var pageviewsInterval = new Dataviz()
                .height(300)
                .el('.pageviews-interval')
                .title('Pageviews by day')
                .type('area')
                .render();

              client
                .query('count', {
                  event_collection: 'pageviews',
                  timeframe: timeframe,
                  interval: 'daily',
                  timezone: 'UTC'
                })
                .then(function(res){
                  // Handle the result
                  pageviewsInterval
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsInterval
                    .message(err.message);
                });

              var pageviews = new Dataviz()
                .height(300)
                .el('.total-pageviews')
                .type('metric')
                .title('Pageviews')
                .prepare();

              client
                .query('count', {
                  event_collection: 'pageviews',
                  timeframe: timeframe,
                  timezone: 'UTC'
                })
                .then(function(res){
                  // Handle the result
                  pageviews
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviews
                    .message(err.message);
                });

              var pageviewsByDay = new Dataviz()
                .height(300)
                .el('.pageviews-by-day')
                .type('horizontal-bar')
                .title('Pageviews by Day of the Week')
                .prepare();

              client
                .query('count',  {
                  event_collection: "pageviews",
                  group_by: [
                  "time.local.day_of_week"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByDay
                    .data(res)
                    .labelMapping({
                    '1': 'Monday',
                    '2': 'Tuesday',
                    '3': 'Wednesday',
                    '4': 'Thursday',
                    '5': 'Friday',
                    '6': 'Saturday',
                    '7': 'Sunday'
                    })
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByDay
                    .message(err.message);
                });

              var pageviewsByBrowser = new Dataviz()
                .height(300)
                .el('.pageviews-by-browser')
                .type('pie')
                .title('Pageviews by Browser')
                .prepare();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "tech.browser.family"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByBrowser
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByBrowser
                    .message(err.message);
                });

              var pageviewsByDevice = new Dataviz()
                .height(300)
                .el('.pageviews-by-device')
                .type('pie')
                .title('Pageviews by Device Family')
                .prepare();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "tech.device.family"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByDevice
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByDevice
                    .message(err.message);
                });

              var popularPages = new Dataviz()
                .height(300)
                .el('.popular-pages-visited')
                .type('line')
                .chartOptions({
                  axis: {
                    y: {
                      padding: {bottom:0}
                    }
                  }
                })
                .title('Popular Pages Visited by Title')
                .prepare();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "url.info.path"],
                  timeframe: timeframe,
                  interval: "daily",
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  popularPages
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  popularPages
                    .message(err.message);
                });

              var pageviewsByCountry = new Dataviz()
                .el('.pageviews-by-country')
                .height(300)
                .type('table')
                .title('Pageviews by Country')
                .render();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "geo.country"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByCountry
                    .data(res)
                    .sortGroups('desc')
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByCountry
                    .message(err.message);
                });

               var pageviewsByCity = new Dataviz()
                .el('.pageviews-by-city')
                .height(300)
                .type('table')
                .title('Pageviews by City')
                .render();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "geo.city"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByCity
                    .data(res)
                    .sortGroups('desc')
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByCity
                    .message(err.message);
                });

              function rand(a, b){
                return Math.floor((Math.random() * b) + a);
              }

              function gen(n){
                var arr = [ faker.internet.exampleEmail() ];
                for (var i = 0; i < n; i++) {
                  arr.push(rand(0, 1000));
                }
                return arr;
              }

            }
        </script>
    </main>

    {{> footer }}
    <!-- Dashboard JS -->
    <script src="https://d26b395fwzu5fz.cloudfront.net/keen-tracking-1.1.3.min.js"></script>
    <script src="https://d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.1.3.min.js"></script>
    <script src="https://d26b395fwzu5fz.cloudfront.net/keen-analysis-1.2.2.js"></script>
    <script>
        // Keen IO Settings
        window.settings = function() {
            var timeframe = {
                start: "2017-06-03T07:00:00.000Z",
                end: new Date().toISOString()
            };

            window.renderCharts(new Keen({
                projectId: '5932a7c595cfc907a1f80c67',
                readKey: '03384FBE774B660D6C84C358DE6B68C0073053180D104FC19752DA666AB92D44032A5F8AE8F7AAE4E93DAAC8303A3C8FB4AEAD402FEC9B639164BC23953BEEC1D3893A48EB449673E429E5593BD22B0ABDA2A407360CF0EF1C7173E41CD03C1F'
            }), timeframe);
        }
    </script>
</body>
</html>
