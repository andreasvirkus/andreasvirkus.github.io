{{> doc-head }}
<link rel="stylesheet" href="https://d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.1.3.min.css">
</head>
<body class="wip-page" onload="settings()">
    {{> header }}

    {{> nav }}

    <main>
        {{{ contents }}}

        <div class="dashboard-container">
            <!-- <nav>
                <ul class="nav nav-tabs">
                    <li role="presentation" class="active"><a href="./index.html">Pageviews</a></li>
                    <li role="presentation"><a href="./clicks.html">Clicks</a></li>
                    <li role="presentation"><a href="./site-builds.html">Builds</a></li>
                </ul>
            </nav> -->

            <h3>Data from last week</h3>

            <div class="keen-ui-row">
                <div class="keen-ui-col-8">
                  <div class="pageviews-interval"></div>
                </div>
                <div class="keen-ui-col-4">
                  <div class="total-pageviews"></div>
                </div>
            </div>

            <div class="keen-ui-row">
                <div class="keen-ui-col-6">
                    <div class="pageviews-by-day"></div>
                </div>
                <div class="keen-ui-col-6">
                    <div class="popular-pages-visited"></div>
                </div>
            </div>

            <div class="keen-ui-row">
                <div class="keen-ui-col-6">
                    <div class="pageviews-by-browser"></div>
                </div>
                <div class="keen-ui-col-6">
                  <div class="pageviews-by-device"></div>
                </div>
            </div>

            <div>
                <div class="keen-ui-col-6">
                    <div class="pageviews-by-country"></div>
                </div>
                <div class="keen-ui-col-6">
                    <div class="pageviews-by-city"></div>
                </div>
            </div>
        </div>

        <script>
            window.renderCharts = function(client, timeframe) {
              var pageviewsInterval = new Dataviz()
                .height(300)
                .el('.pageviews-interval')
                .title('Pageviews by day')
                .type('area')
                .render();

              client
                .query('count', {
                  event_collection: 'pageviews',
                  timeframe: timeframe,
                  interval: 'daily',
                  timezone: 'UTC'
                })
                .then(function(res){
                  // Handle the result
                  pageviewsInterval
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsInterval
                    .message(err.message);
                });

              var pageviews = new Dataviz()
                .height(300)
                .el('.total-pageviews')
                .type('metric')
                .title('Pageviews')
                .prepare();

              client
                .query('count', {
                  event_collection: 'pageviews',
                  timeframe: timeframe,
                  timezone: 'UTC'
                })
                .then(function(res){
                  // Handle the result
                  pageviews
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviews
                    .message(err.message);
                });

            //   var pageviewsByReferrer = new Dataviz()
            //     .el('.pageviews-by-referrer')
            //     .height(300)
            //     .type('table')
            //     .title('Pageviews by Referrer')
            //     .render();
              //
            //   client
            //     .query('count', {
            //       event_collection: 'pageviews',
            //       timeframe: 'previous_1_months',
            //       filters: [
            //       {
            //           "operator": "ne",
            //           "property_name": "referrer.info.domain",
            //           "property_value": null
            //       }],
            //       group_by: [
            //       "referrer.info.domain"],
            //       timezone: 'UTC'
            //     })
            //     .then(function(res){
            //       // Handle the result
            //       pageviewsByReferrer
            //         .data(res)
            //         .sortGroups('desc')
            //         .render();
            //     })
            //     .catch(function(err){
            //       // Handle the error
            //       pageviewsByReferrer
            //         .message(err.message);
            //     });

            //   var uniquePageviews = new Dataviz()
            //     .height(300)
            //     .el('.unique-pageviews')
            //     .type('metric')
            //     .title('Unique Pageviews by UUID')
            //     .prepare();
              //
            //   client
            //     .query('count', {
            //       event_collection: "pageviews",
            //       target_property: "user.uuid",
            //       timeframe: timeframe,
            //       timezone: "UTC"
            //     })
            //     .then(function(res){
            //       // Handle the result
            //       uniquePageviews
            //         .data(res)
            //         .render();
            //     })
            //     .catch(function(err){
            //       // Handle the error
            //       uniquePageviews
            //         .message(err.message);
            //     });

              var pageviewsByDay = new Dataviz()
                .height(300)
                .el('.pageviews-by-day')
                .type('horizontal-bar')
                .title('Pageviews by Day of the Week')
                .prepare();

              client
                .query('count',  {
                  event_collection: "pageviews",
                  group_by: [
                  "time.local.day_of_week"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByDay
                    .data(res)
                    .labelMapping({
                    '1': 'Monday',
                    '2': 'Tuesday',
                    '3': 'Wednesday',
                    '4': 'Thursday',
                    '5': 'Friday',
                    '6': 'Saturday',
                    '7': 'Sunday'
                    })
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByDay
                    .message(err.message);
                });

              var pageviewsByBrowser = new Dataviz()
                .height(300)
                .el('.pageviews-by-browser')
                .type('pie')
                .title('Pageviews by Browser')
                .prepare();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "tech.browser.family"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByBrowser
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByBrowser
                    .message(err.message);
                });

              var pageviewsByDevice = new Dataviz()
                .height(300)
                .el('.pageviews-by-device')
                .type('pie')
                .title('Pageviews by Device Family')
                .prepare();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "tech.device.family"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByDevice
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByDevice
                    .message(err.message);
                });

              var popularPages = new Dataviz()
                .height(300)
                .el('.popular-pages-visited')
                .type('line')
                .chartOptions({
                  axis: {
                    y: {
                      padding: {bottom:0}
                    }
                  }
                })
                .title('Popular Pages Visited by Title')
                .prepare();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "url.info.path"],
                  timeframe: timeframe,
                  interval: "daily",
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  popularPages
                    .data(res)
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  popularPages
                    .message(err.message);
                });

              var pageviewsByCountry = new Dataviz()
                .el('.pageviews-by-country')
                .height(300)
                .type('table')
                .title('Pageviews by Country')
                .render();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "geo.country"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByCountry
                    .data(res)
                    .sortGroups('desc')
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByCountry
                    .message(err.message);
                });

               var pageviewsByCity = new Dataviz()
                .el('.pageviews-by-city')
                .height(300)
                .type('table')
                .title('Pageviews by City')
                .render();

              client
                .query('count', {
                  event_collection: "pageviews",
                  group_by: [
                  "geo.city"],
                  timeframe: timeframe,
                  timezone: "UTC"
                })
                .then(function(res){
                  // Handle the result
                  pageviewsByCity
                    .data(res)
                    .sortGroups('desc')
                    .render();
                })
                .catch(function(err){
                  // Handle the error
                  pageviewsByCity
                    .message(err.message);
                });

              function rand(a, b){
                return Math.floor((Math.random() * b) + a);
              }

              function gen(n){
                var arr = [ faker.internet.exampleEmail() ];
                for (var i = 0; i < n; i++) {
                  arr.push(rand(0, 1000));
                }
                return arr;
              }

            }
        </script>
    </main>

    {{> footer }}
    <!-- Dashboard JS -->
    <script src="https://d26b395fwzu5fz.cloudfront.net/keen-tracking-1.1.3.min.js"></script>
    <script src="https://d26b395fwzu5fz.cloudfront.net/keen-dataviz-1.1.3.min.js"></script>
    <script src="https://d26b395fwzu5fz.cloudfront.net/keen-analysis-1.2.2.js"></script>
    <script>
        // Keen IO Settings
        window.settings = function() {
            var timeframe = "this_2_weeks";

            window.renderCharts(new Keen({
                projectId: '5927310b54532cb1704d5bb0',
                readKey: 'AAE93B711B97204F3CE69675FF406D63E79932C0CE343B7B4C564A380A214D365239F95CD1CF48FB0A925234FB5F9F544B0295EB4A5807A982E8AA15B574D8E2C3573421191F6CB822ADD2B6F59408EF1F1D7935C7F5B4287755B22ADD5B7910'
            }), timeframe);
        }
    </script>
</body>
</html>
